

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>SCOOTR Tutorial &#8212; SCOOTR</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'SCOOTR_tutorial';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Fused Formulation Tutorial" href="fused_tutorial.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/SCOOTR_logo.006.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/SCOOTR_logo.006.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to SCOOTR
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Core Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation_instructions.html">Getting Set Up</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">The Evolution of SCOOTR</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup_tutorial.html">Setup Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="UGW_tutorial.html">UGW Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="UCOOT_tutorial.html">UCOOT Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="fused_tutorial.html">Fused Formulation Tutorial</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">SCOOTR Tutorial</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Cbaker37/SCOOTR.git" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Cbaker37/SCOOTR.git/issues/new?title=Issue%20on%20page%20%2FSCOOTR_tutorial.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/SCOOTR_tutorial.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>SCOOTR Tutorial</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#default-scootr">Default SCOOTR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#entropic-regularization">Entropic Regularization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#marginal-relaxation">Marginal Relaxation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-and-balancing-gw-and-coot">Alpha and Balancing GW and COOT</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#varying-ot-algorithms">Varying OT Algorithms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supervision-extension-of-fused-formulation-to-scootr">Supervision (Extension of Fused Formulation to SCOOTR)</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="scootr-tutorial">
<h1>SCOOTR Tutorial<a class="headerlink" href="#scootr-tutorial" title="Permalink to this heading">#</a></h1>
<p>In this tutorial, we will examine our newest tool, SCOOTR. SCOOTR blends together UGW and UCOOT to incentivise sample alignments that are  informed by both feature correspondence and local geometry. We will again use the CITEseq dataset from earlier tutorials, with the goal of recovering the underlying 1-1 alignment of the 1000 samples by considering expression and antibody data separately.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have not yet configured a SCOOTR directory of some kind, see our installation instructions markdown. Once you complete those steps or set up your own virual environment, continue on here.</p>
<p>If you aren’t sure what any of the parameters for setting up a SCOOTR object mean, try our setup tutorial for getting used to using the tool.</p>
<p>If you are looking for more detail on what the parameters of the alignment do in practice, start by visiting our UGW, UCOOT, and fused formulation tutorials. We will draw on all of these when examining SCOOTR.</p>
<p>If you are unsure what some of the notation means throughout the rest of this document, try reading our optimal transport theory section to get more comfortable.</p>
<p>If you already know how to use SCOOTR, continue on to the next chapter: our explorations of how SCOOTR can be applied!</p>
</div>
<section id="preprocessing">
<h2>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this heading">#</a></h2>
<p>As usual, we set up PyTorch (for UCOOT/UGW, not SCOOTR)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Torch version: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CUDA available: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CUDA version: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">cuda</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CUDNN version: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">version</span><span class="p">()))</span>

<span class="n">use_cuda</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda:0&quot;</span> <span class="k">if</span> <span class="n">use_cuda</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span><span class="o">=</span><span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Torch version: 2.0.1
CUDA available: False
CUDA version: None
CUDNN version: None
</pre></div>
</div>
</div>
</div>
<p>To begin, we will load in our preprocessed data. If you would like to preprocess the data in your own way, you can download the raw files for this dataset by running “sh download_scripts/CITEseq_download.sh” from the root of your SCOOTR directory. They will be loaded into the same folder as the preprocessed datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="kn">import</span> <span class="nn">src.scootr</span> <span class="k">as</span> <span class="nn">scoot</span>
<span class="kn">import</span> <span class="nn">scanpy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">umap</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">normalize</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Helvetica Neue&#39;</span>

<span class="n">X_raw</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/CITEseq/citeseq_adt_normalized_1000cells.csv&quot;</span><span class="p">)</span>
<span class="n">y_raw</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/CITEseq/citeseq_rna_normalizedFC_1000cells.csv&quot;</span><span class="p">)</span>
<span class="n">x_feat_labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CD11a&quot;</span><span class="p">,</span><span class="s2">&quot;CD11c&quot;</span><span class="p">,</span><span class="s2">&quot;CD123&quot;</span><span class="p">,</span><span class="s2">&quot;CD127-IL7Ra&quot;</span><span class="p">,</span><span class="s2">&quot;CD14&quot;</span><span class="p">,</span><span class="s2">&quot;CD16&quot;</span><span class="p">,</span><span class="s2">&quot;CD161&quot;</span><span class="p">,</span><span class="s2">&quot;CD19&quot;</span><span class="p">,</span><span class="s2">&quot;CD197-CCR7&quot;</span><span class="p">,</span><span class="s2">&quot;CD25&quot;</span><span class="p">,</span><span class="s2">&quot;CD27&quot;</span><span class="p">,</span><span class="s2">&quot;CD278-ICOS&quot;</span><span class="p">,</span><span class="s2">&quot;CD28&quot;</span><span class="p">,</span><span class="s2">&quot;CD3&quot;</span><span class="p">,</span><span class="s2">&quot;CD34&quot;</span><span class="p">,</span><span class="s2">&quot;CD38&quot;</span><span class="p">,</span><span class="s2">&quot;CD4&quot;</span><span class="p">,</span><span class="s2">&quot;CD45RA&quot;</span><span class="p">,</span><span class="s2">&quot;CD45RO&quot;</span><span class="p">,</span><span class="s2">&quot;CD56&quot;</span><span class="p">,</span><span class="s2">&quot;CD57&quot;</span><span class="p">,</span><span class="s2">&quot;CD69&quot;</span><span class="p">,</span><span class="s2">&quot;CD79b&quot;</span><span class="p">,</span><span class="s2">&quot;CD8a&quot;</span><span class="p">,</span><span class="s2">&quot;HLA.DR&quot;</span><span class="p">]</span>
<span class="n">y_feat_labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ITGAL&quot;</span><span class="p">,</span><span class="s2">&quot;ITGAX&quot;</span><span class="p">,</span><span class="s2">&quot;IL3RA&quot;</span><span class="p">,</span><span class="s2">&quot;IL7R&quot;</span><span class="p">,</span><span class="s2">&quot;CD14&quot;</span><span class="p">,</span><span class="s2">&quot;FCGR3A&quot;</span><span class="p">,</span><span class="s2">&quot;KLRB1&quot;</span><span class="p">,</span><span class="s2">&quot;CD19&quot;</span><span class="p">,</span><span class="s2">&quot;CCR7&quot;</span><span class="p">,</span><span class="s2">&quot;IL2RA&quot;</span><span class="p">,</span><span class="s2">&quot;CD27&quot;</span><span class="p">,</span><span class="s2">&quot;ICOS&quot;</span><span class="p">,</span><span class="s2">&quot;CD28&quot;</span><span class="p">,</span><span class="s2">&quot;CD3E&quot;</span><span class="p">,</span><span class="s2">&quot;CD34&quot;</span><span class="p">,</span><span class="s2">&quot;CD38&quot;</span><span class="p">,</span><span class="s2">&quot;CD4&quot;</span><span class="p">,</span><span class="s2">&quot;PTPRC&quot;</span><span class="p">,</span><span class="s2">&quot;PTPRC&quot;</span><span class="p">,</span><span class="s2">&quot;NCAM1&quot;</span><span class="p">,</span><span class="s2">&quot;B3GAT1&quot;</span><span class="p">,</span><span class="s2">&quot;CD69&quot;</span><span class="p">,</span><span class="s2">&quot;CD79B&quot;</span><span class="p">,</span><span class="s2">&quot;CD8A&quot;</span><span class="p">,</span><span class="s2">&quot;HLA-DRA&quot;</span><span class="p">]</span> 
<span class="n">samp_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Cell </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</pre></div>
</div>
</div>
</div>
<p>From here, we can load our data into usable DataFrames, as in prior tutorials.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_full_annotated</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="n">X_raw</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">X_full_annotated</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">X_full_annotated</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">samp_labels</span><span class="p">,</span> <span class="n">x_feat_labels</span>
<span class="n">y_full_annotated</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="n">y_raw</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">y_full_annotated</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y_full_annotated</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">samp_labels</span><span class="p">,</span> <span class="n">y_feat_labels</span>

<span class="n">X_full</span> <span class="o">=</span> <span class="n">X_full_annotated</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">y_full</span> <span class="o">=</span> <span class="n">y_full_annotated</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">X_annotated</span> <span class="o">=</span> <span class="n">X_full_annotated</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">y_annotated</span> <span class="o">=</span> <span class="n">y_full_annotated</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">X_annotated</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_annotated</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>In order to keep our objective in mind, let’s look at the UMAP/PCA of each domain pre-alignment one last time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">um</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">originalX_um</span><span class="o">=</span><span class="n">um</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">originaly_um</span><span class="o">=</span><span class="n">um</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1">#Visualization of the global geometry</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">originalX_um</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">originalX_um</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;ADT Domain </span><span class="se">\n</span><span class="s2"> before Alignment&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">originaly_um</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">originaly_um</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Gene Expression Domain </span><span class="se">\n</span><span class="s2"> before Alignment&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9976b46cdd636a2f8286ee128b902ce4ce053f8b50a91507d5f10da6da4eb3e0.png" src="_images/9976b46cdd636a2f8286ee128b902ce4ce053f8b50a91507d5f10da6da4eb3e0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">pca</span><span class="o">=</span><span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">originalX_pca</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">originaly_pca</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1">#Visualization of the global geometry</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">originalX_pca</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">originalX_pca</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;ADT Domain </span><span class="se">\n</span><span class="s2"> before Alignment&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">originaly_pca</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">originaly_pca</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Gene Expression Domain </span><span class="se">\n</span><span class="s2"> before Alignment&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cb2979e2028e700f715dcdf003c2d196a2523f62cef0702a37d6148ce2c57004.png" src="_images/cb2979e2028e700f715dcdf003c2d196a2523f62cef0702a37d6148ce2c57004.png" />
</div>
</div>
</section>
<section id="default-scootr">
<h2>Default SCOOTR<a class="headerlink" href="#default-scootr" title="Permalink to this heading">#</a></h2>
<p>Next, we can instantiate a SCOOTR object to begin aligning our data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike UCOOT and UGW, SCOOTR allows us to use conditional gradient descent to solve sample alignments, and earth mover’s distance to solve either sample or feature alignments. These OT algorithms (that take place at each inner process of a BCD iteration) converge at different speeds; we recommend following the nits_uot guidelines below.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scootr_sink</span> <span class="o">=</span> <span class="n">scoot</span><span class="o">.</span><span class="n">SCOOTR</span><span class="p">(</span><span class="n">nits_bcd</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">eval_bcd</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">scootr_cg</span> <span class="o">=</span> <span class="n">scoot</span><span class="o">.</span><span class="n">SCOOTR</span><span class="p">(</span><span class="n">nits_bcd</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">nits_uot</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">eval_bcd</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">scootr_emd</span> <span class="o">=</span> <span class="n">scoot</span><span class="o">.</span><span class="n">SCOOTR</span><span class="p">(</span><span class="n">nits_bcd</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">nits_uot</span><span class="o">=</span><span class="mf">1e7</span><span class="p">,</span> <span class="n">eval_bcd</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>From here, we can begin by establishing pairwise distance matrices for our domains, as per the UGW tutorial:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># knn connectivity distance</span>
<span class="n">Dx_knn</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">knn_dist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;connectivity&#39;</span><span class="p">)</span>
<span class="n">Dy_knn</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">knn_dist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;connectivity&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we are all set up to run an alignment between <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(y\)</span>, we will pause for a moment to examine what SCOOTR is trying to do. As we did with UGW and UCOOT, let’s examine the objective function that SCOOTR is hoping to minimize. First, recall our UGW objective function:</p>
<p><span class="math notranslate nohighlight">\(GW(\pi_s) = L_{GW}(D(x_i, x_j), D(y_k, y_l)) \cdot \pi_{s_{ij}} \cdot \pi_{s_{kl}}\)</span> for all samples <span class="math notranslate nohighlight">\(i, j\)</span> in <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(k, l\)</span> in <span class="math notranslate nohighlight">\(y\)</span>. Recall that <span class="math notranslate nohighlight">\(L_{GW}\)</span> is euclidean distance for our purposes. Now, we re-examine the UCOOT objective function:</p>
<p><span class="math notranslate nohighlight">\(COOT(\pi_s, \pi_f) = L_{COOT}(X_{ij}, y_{kl}) \cdot \pi_{s_{ik}} \cdot \pi_{f_{jl}}\)</span> for all samples <span class="math notranslate nohighlight">\(i\)</span> in <span class="math notranslate nohighlight">\(X\)</span>, features <span class="math notranslate nohighlight">\(j\)</span> in <span class="math notranslate nohighlight">\(X\)</span>, samples <span class="math notranslate nohighlight">\(k\)</span> in <span class="math notranslate nohighlight">\(y\)</span>, and features <span class="math notranslate nohighlight">\(l\)</span> in <span class="math notranslate nohighlight">\(y\)</span>. Again, <span class="math notranslate nohighlight">\(L_{COOT}\)</span> is euclidean distance for our purposes. Given these two functions, our SCOOTR objective function is as follows:</p>
<p><span class="math notranslate nohighlight">\(\alpha GW(\pi_s) + (1 - \alpha) COOT(\pi_s, \pi_f)\)</span></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note that we have a new hyperparameter <span class="math notranslate nohighlight">\(\alpha\)</span> – this is NOT the same <span class="math notranslate nohighlight">\(\alpha\)</span> we used in the fused formulation. In this case, <span class="math notranslate nohighlight">\(\alpha\)</span> trades off how much we use GW versus COOT in our optimization procedure.</p>
</div>
<p>This SCOOTR objective function allows us to continue employing BCD, as we can also frame it as follows:</p>
<p><span class="math notranslate nohighlight">\(\langle \alpha L_{GW}(D_X, D_y) \otimes \pi_s + (1 - \alpha) L_{COOT}(X, y) \otimes \pi_f, \pi_s \rangle\)</span> where <span class="math notranslate nohighlight">\(D_X\)</span> and <span class="math notranslate nohighlight">\(D_y\)</span> are the distance matrices we constructed earlier.</p>
<p>As seen in this function, SCOOTR takes the shape of a COOT problem, albeit with a more complicated tensor on the left side of the inner product.</p>
<p>SCOOTR allows us to look at local geometry (GW) and feature correspondence (COOT) when optimizing a given <span class="math notranslate nohighlight">\(\pi_s\)</span>. If you would like more information on the theory behind why SCOOTR works, look at our theory document early in this tutorial chapter. Let’s try an alignment:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="p">(</span><span class="n">pi_samp</span><span class="p">,</span> <span class="n">pi_feat</span><span class="p">),</span> <span class="n">_</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">agw_scootr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Dx_knn</span><span class="p">,</span> <span class="n">Dy_knn</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">sample_eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">feature_eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">sample_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">feature_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">log</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pi_feat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X_annotated</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">y_annotated</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">pi_samp</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3cb4d0a384e6c80a15e2cc626b6c8d725cbf977e12eaea9a2d86147dc6ee120a.png" src="_images/3cb4d0a384e6c80a15e2cc626b6c8d725cbf977e12eaea9a2d86147dc6ee120a.png" />
</div>
</div>
<p>Note that we used Sinkhorn to generate these coupling matrices, rather than EMD or CG. EMD and CG work very differently to Sinkhorn; we will examine this difference in a later section. For now, we will quickly glance over how entropic regularization and marginal relaxation extend to SCOOTR.</p>
</section>
<section id="entropic-regularization">
<h2>Entropic Regularization<a class="headerlink" href="#entropic-regularization" title="Permalink to this heading">#</a></h2>
<p>Entropic regularization functions the same as in prior tutorials, at least when the Sinkhorn option is selected – if you are curious about what entropic regularization does, look at the UGW or UCOOT tutorials. We can quickly show that this similarity holds by experimenting with a few different values of epsilon.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="p">(</span><span class="n">pi_samp_lg</span><span class="p">,</span> <span class="n">pi_feat_lg</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">agw_scootr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Dx_knn</span><span class="p">,</span> <span class="n">Dy_knn</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">sample_eps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature_eps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">feature_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="p">(</span><span class="n">pi_samp_med</span><span class="p">,</span> <span class="n">pi_feat_med</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">agw_scootr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Dx_knn</span><span class="p">,</span> <span class="n">Dy_knn</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">sample_eps</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">feature_eps</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">sample_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">feature_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="p">(</span><span class="n">pi_samp_sm</span><span class="p">,</span> <span class="n">pi_feat_sm</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">agw_scootr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Dx_knn</span><span class="p">,</span> <span class="n">Dy_knn</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">sample_eps</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">,</span> <span class="n">feature_eps</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">,</span> <span class="n">sample_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">feature_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">pi_feat</span><span class="p">,</span> <span class="n">pi_samp</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">pi_feat_sm</span><span class="p">,</span> <span class="n">pi_samp_sm</span><span class="p">,</span> <span class="s1">&#39;eps=5e-4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">pi_feat_med</span><span class="p">,</span> <span class="n">pi_samp_med</span><span class="p">,</span> <span class="s1">&#39;eps=1e-3&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">pi_feat_lg</span><span class="p">,</span> <span class="n">pi_samp_lg</span><span class="p">,</span> <span class="s1">&#39;eps=1&#39;</span><span class="p">)]:</span>
    
    <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pi_feat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X_annotated</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">y_annotated</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">pi_samp</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9b2da646b5ed107d1aae11a9d9e8a05cd3ca237c409f3d6e590f1a6b77b3fe0c.png" src="_images/9b2da646b5ed107d1aae11a9d9e8a05cd3ca237c409f3d6e590f1a6b77b3fe0c.png" />
<img alt="_images/3cb4d0a384e6c80a15e2cc626b6c8d725cbf977e12eaea9a2d86147dc6ee120a.png" src="_images/3cb4d0a384e6c80a15e2cc626b6c8d725cbf977e12eaea9a2d86147dc6ee120a.png" />
<img alt="_images/97cc8b7efea1f35ebbe0555ee259a6317f09d5307f9b614471bb872b481131e2.png" src="_images/97cc8b7efea1f35ebbe0555ee259a6317f09d5307f9b614471bb872b481131e2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">pi_feat</span><span class="p">,</span> <span class="n">pi_samp</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">pi_feat_sm</span><span class="p">,</span> <span class="n">pi_samp_sm</span><span class="p">,</span> <span class="s1">&#39;eps=5e-4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">pi_feat_med</span><span class="p">,</span> <span class="n">pi_samp_med</span><span class="p">,</span> <span class="s1">&#39;eps=1e-3&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">pi_feat_lg</span><span class="p">,</span> <span class="n">pi_samp_lg</span><span class="p">,</span> <span class="s1">&#39;eps=1&#39;</span><span class="p">)]:</span>
    
    <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pi_feat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X_annotated</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">y_annotated</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">pi_samp</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9b2da646b5ed107d1aae11a9d9e8a05cd3ca237c409f3d6e590f1a6b77b3fe0c.png" src="_images/9b2da646b5ed107d1aae11a9d9e8a05cd3ca237c409f3d6e590f1a6b77b3fe0c.png" />
<img alt="_images/3cb4d0a384e6c80a15e2cc626b6c8d725cbf977e12eaea9a2d86147dc6ee120a.png" src="_images/3cb4d0a384e6c80a15e2cc626b6c8d725cbf977e12eaea9a2d86147dc6ee120a.png" />
<img alt="_images/97cc8b7efea1f35ebbe0555ee259a6317f09d5307f9b614471bb872b481131e2.png" src="_images/97cc8b7efea1f35ebbe0555ee259a6317f09d5307f9b614471bb872b481131e2.png" />
</div>
</div>
<p>As seen above, high epsilon still encourages density, while a low epsilon leads to more sparse coupling matrices.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>While entropic regularization still works as expected for the Sinkhorn option, neither CG nor EMD are entropically regularized at all. They provide significantly more sparse coupling matrices, as we will see later on. If an epsilon value is present and CG/EMD are used for inner OT iterations for one of the coupling matrices, the epsilon value will be ignored when optimizing this coupling matrix.</p>
</div>
</section>
<section id="marginal-relaxation">
<h2>Marginal Relaxation<a class="headerlink" href="#marginal-relaxation" title="Permalink to this heading">#</a></h2>
<p>Unlike UGW and UCOOT, our current version of SCOOTR does not allow for marginal relaxation. We may add <span class="math notranslate nohighlight">\(\rho\)</span> as a hyperparameter in the future, but for the moment, we do not support it. The lack of marginal relaxation in SCOOTR places more emphasis on sample supervision and the initial distributions we use.</p>
</section>
<section id="alpha-and-balancing-gw-and-coot">
<h2>Alpha and Balancing GW and COOT<a class="headerlink" href="#alpha-and-balancing-gw-and-coot" title="Permalink to this heading">#</a></h2>
<p>Now, we can examine SCOOTR closely. We will start by looking at <span class="math notranslate nohighlight">\(\alpha\)</span>, and then move on to algorithmic decisions and sample/feature supervision.</p>
<p>To start, we will compare the <span class="math notranslate nohighlight">\(\alpha = 0\)</span> and <span class="math notranslate nohighlight">\(\alpha = 1\)</span> cases to UGW and UCOOT, using the Sinkhorn algorithm (the common algorithm that both SCOOTR and UGW/UCOOT use).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="p">(</span><span class="n">pi_samp_sgw</span><span class="p">,</span> <span class="n">pi_feat_sgw</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">agw_scootr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Dx_knn</span><span class="p">,</span> <span class="n">Dy_knn</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">feature_eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">sample_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">feature_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="p">(</span><span class="n">pi_samp_ugw</span><span class="p">,</span> <span class="n">_</span><span class="p">),</span> <span class="n">duals</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">solver_fgw</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">Dx_knn</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">Dy_knn</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="p">(</span><span class="n">pi_samp_scoot</span><span class="p">,</span> <span class="n">pi_feat_scoot</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">agw_scootr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Dx_knn</span><span class="p">,</span> <span class="n">Dy_knn</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">feature_eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">sample_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">feature_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="p">(</span><span class="n">pi_samp_ucoot</span><span class="p">,</span> <span class="n">pi_feat_ucoot</span><span class="p">),</span> <span class="n">duals</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">solver_fcoot</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Oddly enough, the coupling matrices are not too similar. In particular, examine the feature coupling matrices from SCOOTR with <span class="math notranslate nohighlight">\(\alpha=0\)</span> and UCOOT:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">pi_feat</span> <span class="ow">in</span> <span class="n">pi_feat_scoot</span><span class="p">,</span> <span class="n">pi_feat_ucoot</span><span class="p">:</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pi_feat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X_annotated</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">y_annotated</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/87a3ba7db3f3d7dc045de22e425835a6a4b9ed0e959cec7553072e21d98c6634.png" src="_images/87a3ba7db3f3d7dc045de22e425835a6a4b9ed0e959cec7553072e21d98c6634.png" />
<img alt="_images/2e895cadd2ef53424a6fc8d4eb33d46d6333daa86ee6d610d4e707820f048b13.png" src="_images/2e895cadd2ef53424a6fc8d4eb33d46d6333daa86ee6d610d4e707820f048b13.png" />
</div>
</div>
<p>Considering SCOOTR with <span class="math notranslate nohighlight">\(\alpha=1\)</span> should be doing the same thing as UCOOT, this is a surprising result. From here, we can look at an intermediate value of <span class="math notranslate nohighlight">\(\alpha\)</span>, and compare visualizations with <span class="math notranslate nohighlight">\(\alpha=0\)</span> and <span class="math notranslate nohighlight">\(\alpha=1\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="p">(</span><span class="n">pi_samp_shalf</span><span class="p">,</span> <span class="n">pi_feat_shalf</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">agw_scootr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Dx_knn</span><span class="p">,</span> <span class="n">Dy_knn</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">sample_eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">feature_eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">sample_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">feature_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We begin by projecting and scoring these alignments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aligned_y_sgw</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">get_barycentre</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pi_samp_sgw</span><span class="p">)</span>
<span class="n">aligned_y_shalf</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">get_barycentre</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pi_samp_shalf</span><span class="p">)</span>
<span class="n">aligned_y_scoot</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">get_barycentre</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pi_samp_scoot</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">aligned_y</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">aligned_y_scoot</span><span class="p">,</span> <span class="s1">&#39;alpha=0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">aligned_y_shalf</span><span class="p">,</span> <span class="s1">&#39;alpha=0.5&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">aligned_y_scoot</span><span class="p">,</span> <span class="s1">&#39;alpha=1&#39;</span><span class="p">)]:</span>
    <span class="n">fracs</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">calc_domainAveraged_FOSCTTM</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">aligned_y</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average FOSCTTM score for this alignment (</span><span class="si">{0}</span><span class="s2">) with X onto Y is:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">size</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fracs</span><span class="p">))</span>
    <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;SCOOTR alignment FOSCTTM </span><span class="se">\n</span><span class="s2"> average value for </span><span class="si">{0}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fracs</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fracs</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">fracs</span><span class="p">),</span> <span class="s2">&quot;b--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">legend_label</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cells&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Sorted FOSCTTM&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average FOSCTTM score for this alignment (alpha=0) with X onto Y is: 0.5207507507507507
</pre></div>
</div>
<img alt="_images/54aadfd7447895224a125a73ce13ea042448d3e8cfe8eda1980bbf35ae2f8fd2.png" src="_images/54aadfd7447895224a125a73ce13ea042448d3e8cfe8eda1980bbf35ae2f8fd2.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average FOSCTTM score for this alignment (alpha=0.5) with X onto Y is: 0.5321211211211212
</pre></div>
</div>
<img alt="_images/52d31cccef3526e264d270c993eb83d9085cccbc1abf3baef831dde8a71f1b60.png" src="_images/52d31cccef3526e264d270c993eb83d9085cccbc1abf3baef831dde8a71f1b60.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average FOSCTTM score for this alignment (alpha=1) with X onto Y is: 0.5207507507507507
</pre></div>
</div>
<img alt="_images/e29719aa158a5f5315cb3da5669e58ffd58a1cdb5115edffd6ef72208768f04a.png" src="_images/e29719aa158a5f5315cb3da5669e58ffd58a1cdb5115edffd6ef72208768f04a.png" />
</div>
</div>
<p>In addition, we can examine the coupling matrices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">pi_feat</span><span class="p">,</span> <span class="n">pi_samp</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">pi_feat_scoot</span><span class="p">,</span> <span class="n">pi_samp_scoot</span><span class="p">,</span> <span class="s1">&#39;alpha=0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">pi_feat_shalf</span><span class="p">,</span> <span class="n">pi_samp_shalf</span><span class="p">,</span> <span class="s1">&#39;alpha=0.5&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">pi_feat_sgw</span><span class="p">,</span> <span class="n">pi_samp_sgw</span><span class="p">,</span> <span class="s1">&#39;alpha=1&#39;</span><span class="p">)]:</span>
    
    <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pi_feat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X_annotated</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">y_annotated</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">pi_samp</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/021bfc398f453dd14b0b5182f74eece0431614da342717eb84cc74e99daaf262.png" src="_images/021bfc398f453dd14b0b5182f74eece0431614da342717eb84cc74e99daaf262.png" />
<img alt="_images/cbc81560b7e43b1b1aa043c0e73e9d3025d1ca7431a142acbe1842c2b0935fc7.png" src="_images/cbc81560b7e43b1b1aa043c0e73e9d3025d1ca7431a142acbe1842c2b0935fc7.png" />
<img alt="_images/dd3527b448ca11c25813ed5747b13beb8728e4c680d28e28096981bb6e29b56a.png" src="_images/dd3527b448ca11c25813ed5747b13beb8728e4c680d28e28096981bb6e29b56a.png" />
</div>
</div>
<p>Note that the middle matrices, <span class="math notranslate nohighlight">\(\alpha=0.5\)</span>, appear to be somewhere in between the equivalent matrices for <span class="math notranslate nohighlight">\(\alpha=0\)</span> and <span class="math notranslate nohighlight">\(\alpha=1\)</span>. We recommend linearly searching over <span class="math notranslate nohighlight">\(\alpha\)</span>, as some datasets benefit more from focus on local geometry (high alpha), while some benefit from more focus on feature correspondence (low alpha, when features have strong relationships). As an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># an example of alpha search</span>
<span class="n">pi_samp_dt</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">pi_feat_dt</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># for val in np.linspace(start=0, stop=-1, num=10):</span>
    <span class="c1"># (pi_samp_dt[val], pi_feat_dt[val]), _ = scootr_sink.agw_scootr(X, y, Dx_knn, Dy_knn, alpha=val, sample_eps=sample_eps, feature_eps=feature_eps, sample_uot_mode=mode, feature_uot_mode=mode, verbose=True, log=False)</span>
</pre></div>
</div>
</div>
</div>
<p>From here, we will examine algorithmic decisions with SCOOTR.</p>
</section>
<section id="varying-ot-algorithms">
<h2>Varying OT Algorithms<a class="headerlink" href="#varying-ot-algorithms" title="Permalink to this heading">#</a></h2>
<p>While SCOOTR employs the same BCD approach to optimize <span class="math notranslate nohighlight">\(\pi_s\)</span> and <span class="math notranslate nohighlight">\(\pi_f\)</span> as in UGW/UCOOT, it allows for varying processes to solve BCD’s inner OT iterations. As mentioned previously, it allows for conditional gradient descent (CG), earth mover’s distance (EMD), and Sinkhorn on the sample side, and EMD and Sinkhorn on the feature side. Recall from earlier that none of these algorithms support marginal relaxation, and only Sinkhorn supports entropic regularization. Here’s an example of using each of the different algorithms (via the sample/feature_uot_mode parameters):</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Recall from earlier that we use a different nits_uot for these three algorithms (via different SCOOTR objects), as their convergence speeds vary significantly.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="p">(</span><span class="n">pi_samp_sink</span><span class="p">,</span> <span class="n">pi_feat_sink</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">agw_scootr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Dx_knn</span><span class="p">,</span> <span class="n">Dy_knn</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">sample_eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">feature_eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">sample_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">feature_uot_mode</span><span class="o">=</span><span class="s1">&#39;sinkhorn&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="p">(</span><span class="n">pi_samp_emd</span><span class="p">,</span> <span class="n">pi_feat_emd</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scootr_emd</span><span class="o">.</span><span class="n">agw_scootr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Dx_knn</span><span class="p">,</span> <span class="n">Dy_knn</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">sample_uot_mode</span><span class="o">=</span><span class="s1">&#39;emd&#39;</span><span class="p">,</span> <span class="n">feature_uot_mode</span><span class="o">=</span><span class="s1">&#39;emd&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="p">(</span><span class="n">pi_samp_cg</span><span class="p">,</span> <span class="n">pi_feat_cg</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scootr_cg</span><span class="o">.</span><span class="n">agw_scootr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Dx_knn</span><span class="p">,</span> <span class="n">Dy_knn</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">sample_uot_mode</span><span class="o">=</span><span class="s1">&#39;cg&#39;</span><span class="p">,</span> <span class="n">feature_uot_mode</span><span class="o">=</span><span class="s1">&#39;emd&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aligned_y_sink</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">get_barycentre</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pi_samp_sink</span><span class="p">)</span>
<span class="n">aligned_y_emd</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">get_barycentre</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pi_samp_emd</span><span class="p">)</span>
<span class="n">aligned_y_cg</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">get_barycentre</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pi_samp_cg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can score and visualize as usual:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">aligned_y</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">aligned_y_sink</span><span class="p">,</span> <span class="s1">&#39;sinkhorn&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">aligned_y_emd</span><span class="p">,</span> <span class="s1">&#39;emd&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">aligned_y_cg</span><span class="p">,</span> <span class="s1">&#39;cg&#39;</span><span class="p">)]:</span>
    <span class="n">fracs</span> <span class="o">=</span> <span class="n">scootr_sink</span><span class="o">.</span><span class="n">calc_domainAveraged_FOSCTTM</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">aligned_y</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average FOSCTTM score for this alignment (</span><span class="si">{0}</span><span class="s2">) with X onto Y is:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fracs</span><span class="p">))</span>
    <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;SCOOTR alignment FOSCTTM </span><span class="se">\n</span><span class="s2"> average value for </span><span class="si">{0}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fracs</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fracs</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">fracs</span><span class="p">),</span> <span class="s2">&quot;b--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">legend_label</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cells&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Sorted FOSCTTM&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average FOSCTTM score for this alignment (sinkhorn) with X onto Y is: 0.5333918918918918
</pre></div>
</div>
<img alt="_images/8767fda1459642511758264ae11a7536391ebe407a143dd4fac8f6ee457b98ef.png" src="_images/8767fda1459642511758264ae11a7536391ebe407a143dd4fac8f6ee457b98ef.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average FOSCTTM score for this alignment (emd) with X onto Y is: 0.5212527527527527
</pre></div>
</div>
<img alt="_images/a570b5295e4d56fc1b87b59e147178dcc4c36b92c851608b523d3ab4d4707509.png" src="_images/a570b5295e4d56fc1b87b59e147178dcc4c36b92c851608b523d3ab4d4707509.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average FOSCTTM score for this alignment (cg) with X onto Y is: 0.4121321321321321
</pre></div>
</div>
<img alt="_images/51c7f4dcee3d3d15d8714402cdbc4e8b8e253cbbab56c616cbf89ea5e07b010c.png" src="_images/51c7f4dcee3d3d15d8714402cdbc4e8b8e253cbbab56c616cbf89ea5e07b010c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">pi_feat</span><span class="p">,</span> <span class="n">pi_samp</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">pi_feat_sink</span><span class="p">,</span> <span class="n">pi_samp_sink</span><span class="p">,</span> <span class="s1">&#39;sink&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">pi_feat_emd</span><span class="p">,</span> <span class="n">pi_samp_emd</span><span class="p">,</span> <span class="s1">&#39;emd&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">pi_feat_cg</span><span class="p">,</span> <span class="n">pi_samp_cg</span><span class="p">,</span> <span class="s1">&#39;cg&#39;</span><span class="p">)]:</span>
    
    <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pi_feat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X_annotated</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">y_annotated</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">pi_samp</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3cb4d0a384e6c80a15e2cc626b6c8d725cbf977e12eaea9a2d86147dc6ee120a.png" src="_images/3cb4d0a384e6c80a15e2cc626b6c8d725cbf977e12eaea9a2d86147dc6ee120a.png" />
<img alt="_images/6f8305bd08ef3e0b6468e4a851f7181111399d1b15fd62da6bea016ad5001021.png" src="_images/6f8305bd08ef3e0b6468e4a851f7181111399d1b15fd62da6bea016ad5001021.png" />
<img alt="_images/dc01e0ee8f06c15051d0466414fd4f9374d5efb8b41acec43365584ba603b768.png" src="_images/dc01e0ee8f06c15051d0466414fd4f9374d5efb8b41acec43365584ba603b768.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pca</span><span class="o">=</span><span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Xy_pca</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">aligned_y_sink</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">X_pca</span><span class="o">=</span><span class="n">Xy_pca</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1000</span><span class="p">,]</span>
<span class="n">y_pca</span><span class="o">=</span><span class="n">Xy_pca</span><span class="p">[</span><span class="mi">1000</span><span class="p">:,]</span>

<span class="c1"># Plot aligned domains, samples colored by domain identity:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_pca</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_pca</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ADT&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_pca</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_pca</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gene Expression&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0ae1450bca846a791d45388621a4e506e402d701044c9f0b2a8320ee8b59e774.png" src="_images/0ae1450bca846a791d45388621a4e506e402d701044c9f0b2a8320ee8b59e774.png" />
</div>
</div>
<p>Hopefully, these examples give you a sense of how to use Sinkhorn, CG, and EMD. CG and EMD seek to solve the exact same inner OT problem, while Sinkhorn seeks to solve this same problem as <span class="math notranslate nohighlight">\(\epsilon \to 0\)</span>. We recommend trying out each approach for your data; in this case, we can see that CG performs the best. Now, we move on to supervision.</p>
</section>
<section id="supervision-extension-of-fused-formulation-to-scootr">
<h2>Supervision (Extension of Fused Formulation to SCOOTR)<a class="headerlink" href="#supervision-extension-of-fused-formulation-to-scootr" title="Permalink to this heading">#</a></h2>
<p><em>THIS SECTION IS STILL UNDER DEVELOPMENT</em></p>
<p>In one of our application notebooks, we examine potential ways to generate sample and feature supervision matrices given cell types (sample supervision) prior knowledge (feature supervision).</p>
<p>We have now concluded the SCOOTR tutorial. The key differences between SCOOTR and UCOOT/UGW are:</p>
<ol class="arabic simple">
<li><p>SCOOTR uses <span class="math notranslate nohighlight">\(\alpha\)</span> to denote the GW/COOT balance, rather than a supervision coefficient.</p></li>
<li><p>SCOOTR allows for conditional gradient descent and earth mover’s distance for inner OT iterations on the sample matrix, and earth mover’s distance for inner OT iterations on the feature matrix. It does not support the majorization-minimization algorithm.</p></li>
<li><p>SCOOTR does not allow for marginal relaxation, and only allows for entropic regularization when Sinkhorn is the selected algorithm.</p></li>
<li><p>SCOOTR brings together GW/COOT simultaneously to improve alignment quality and account for both feature correspondence as well as local geometry.</p></li>
</ol>
<p>Now that you have reached this stage, we recommend viewing our application notebooks! These tutorials have attempted to help give you intuition for the parameters, algorithms, etc., but they do not display well what to do in practice on unpaired datasets and how to score these circumstances. Continue on to learn more about how SCOOTR can better align your data.</p>
<p>Citations:</p>
<p>Pinar Demetci, Quang Huy Tran, Ievgen Redko, Ritambhara Singh. Revisiting invariances and introducing priors in Gromov-Wasserstein distances. arXiv, <a class="reference external" href="http://stat.ML">stat.ML</a>, 2023.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="fused_tutorial.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Fused Formulation Tutorial</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#default-scootr">Default SCOOTR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#entropic-regularization">Entropic Regularization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#marginal-relaxation">Marginal Relaxation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-and-balancing-gw-and-coot">Alpha and Balancing GW and COOT</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#varying-ot-algorithms">Varying OT Algorithms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supervision-extension-of-fused-formulation-to-scootr">Supervision (Extension of Fused Formulation to SCOOTR)</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By R. Singh
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>